# Auditoría funcional del Gestor de Progreso de Titulación

## Resumen de la arquitectura actual
- **Autenticación y registro**: `AuthController` maneja inicio de sesión, registro, restablecimiento de contraseña y cierre de sesión con sesiones PHP y hashing seguro de contraseñas.【F:app/Controllers/AuthController.php†L1-L142】【F:app/Models/User.php†L42-L119】
- **Gestión de proyectos**: `ProjectController` permite a estudiantes y directores crear proyectos asignando responsable y controlar el estado, respaldado por el modelo `Project` que crea la tabla y persiste la información.【F:app/Controllers/ProjectController.php†L1-L127】【F:app/Models/Project.php†L1-L109】
- **Hitos, entregas y retroalimentación**: `MilestoneController` administra hitos, envíos de avances con archivos adjuntos y comentarios asociados a cada entrega; los modelos `Milestone`, `Submission` y `Comment` generan las tablas necesarias y encapsulan operaciones CRUD.【F:app/Controllers/MilestoneController.php†L1-L225】【F:app/Models/Milestone.php†L1-L93】【F:app/Models/Submission.php†L1-L87】【F:app/Models/Comment.php†L1-L80】
- **Visualización del progreso**: `ProgressController` resume métricas globales de proyectos y próximos vencimientos para mostrar en la vista `progress/index.php`.【F:app/Controllers/ProgressController.php†L1-L99】【F:app/Views/progress/index.php†L1-L120】

## Errores y riesgos detectados
1. **Flujo de recuperación de contraseña inseguro**: `AuthController::requestPasswordChange` permite cambiar la contraseña con solo conocer el correo, sin enviar token de confirmación ni verificar propiedad vía correo electrónico, lo que abre la puerta a secuestro de cuentas si un actor conoce la dirección de correo institucional.【F:app/Controllers/AuthController.php†L89-L138】
2. **Ausencia de límites de tamaño y validación de tipo MIME en archivos**: al subir entregables se valida la extensión, pero no el tamaño ni el tipo MIME real, por lo que podrían cargarse archivos muy grandes o con extensiones manipuladas que saturen el almacenamiento o supongan un riesgo de seguridad.【F:app/Controllers/MilestoneController.php†L117-L173】
3. **Proyección incompleta de estados del proyecto en el tablero**: `ProgressController` y la vista de progreso asumen que todos los proyectos tienen estados definidos (`planeacion`, `en_progreso`, `en_revision`, `finalizado`); si en la base de datos se inserta otro estado (por ejemplo mediante migración futura o error manual), las métricas producirán índices indefinidos y una vista inconsistente.【F:app/Controllers/ProgressController.php†L35-L73】【F:app/Views/progress/index.php†L12-L44】

## Requerimientos funcionales vs. implementación
| Requerimiento | Estado actual | Observaciones |
| --- | --- | --- |
| Creación de proyectos estudiante ↔ director | ✅ Implementado mediante formularios diferenciados por rol y modelo `Project`. | Considerar reglas adicionales (p. ej. evitar duplicados) si el plan de titulación lo exige.【F:app/Controllers/ProjectController.php†L45-L124】 |
| Definición de hitos y fechas | ✅ Habilitado en `MilestoneController::store` con campos de título, descripción y fecha límite. | Validación básica de fecha ya presente.【F:app/Controllers/MilestoneController.php†L65-L111】 |
| Subida de avances (documentos/código) | ⚠️ Parcial: se permite adjuntar archivos pero falta controlar tamaño, validar MIME y mostrar historial con paginación para evitar cargas pesadas. | También sería útil informar tamaño máximo permitido al usuario.【F:app/Controllers/MilestoneController.php†L117-L188】 |
| Feedback de los directores | ✅ Conversaciones centralizadas en la sección "Comentarios y feedback" con hilos generales por hito y respuestas sobre entregas recientes e históricas. | Mantener el control de permisos al extender funcionalidades colaborativas.【F:app/Controllers/FeedbackController.php†L1-L146】【F:app/Views/feedback/index.php†L1-L247】 |
| Visualización del progreso (Kanban o Gantt simplificado) | ✅ Implementado con un tablero Kanban que agrupa los hitos por estado y resalta vencimientos próximos o atrasados directamente en la vista de progreso. | Mantener la consistencia de estados controlando los valores permitidos en BD y controladores.【F:app/Controllers/ProgressController.php†L47-L150】【F:app/Views/progress/index.php†L1-L176】 |

## Recomendaciones para completar el proyecto
1. **Fortalecer la recuperación de contraseña**: introducir tokens firmados y expirables enviados por correo, de modo que el cambio solo sea posible tras confirmar la identidad del usuario.【F:app/Controllers/AuthController.php†L89-L138】
2. **Validar archivos adjuntos en profundidad**: agregar límites de tamaño configurables y comprobar el MIME real (`finfo_file`) antes de guardar el archivo en `storage/uploads`. También convendría mostrar mensajes claros cuando un archivo exceda el límite.【F:app/Controllers/MilestoneController.php†L117-L173】
3. **Gestionar estados de forma centralizada**: definir constantes/enums para los estados de proyectos e hitos que se usen tanto en BD como en controladores y vistas, evitando valores no contemplados y simplificando futuras extensiones.【F:app/Controllers/ProgressController.php†L35-L96】【F:app/Models/Project.php†L17-L64】
4. **Documentar requisitos operativos**: añadir instrucciones en README sobre preparación de la base de datos SQLite/MySQL, permisos de la carpeta `storage/uploads` y variables de entorno necesarias para desplegar el sistema.【F:config/app.php†L1-L22】【F:app/Core/Database.php†L1-L51】
